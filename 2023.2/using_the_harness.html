<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
<!-- OneTrust Cookies Consent Notice start for xilinx.github.io -->

<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="03af8d57-0a04-47a6-8f10-322fa00d8fc7" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice end for xilinx.github.io -->
<!-- Google Tag Manager -->
<script type="text/plain" class="optanon-category-C0002">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5RHQV7');</script>
<!-- End Google Tag Manager -->
  <title>Using the Test Harness &mdash; AIE Test Harness v2023.2 documentation</title><link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Step by Step Example" href="step_by_step_example.html" />
    <link rel="prev" title="Software APIs" href="sw_apis.html" /> 
</head>

<body class="wy-body-for-nav">

<!-- Google Tag Manager -->
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5RHQV7" height="0" width="0" style="display:none;visibility:hidden" class="optanon-category-C0002"></iframe></noscript>
<!-- End Google Tag Manager --> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
            <a href="index.html" class="icon icon-home"> AIE Test Harness
          </a>
              <div class="version">
                2023.2
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="release_notes.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
</ul>
<p class="caption"><span class="caption-text">User Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="hw_features.html">Hardware Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="sw_apis.html">Software APIs</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Using the Test Harness</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#environment-setup">Environment Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="#instrumenting-the-ai-engine-graph">Instrumenting the AI Engine Graph</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#test-harness-header-file">Test Harness Header File</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mapping-plios">Mapping PLIOs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#occupying-unused-plios">Occupying unused PLIOs</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#creating-the-sw-application">Creating the SW Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="#testing-on-hardware">Testing on Hardware</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#building-the-ai-engine-graph">Building the AI Engine Graph</a></li>
<li class="toctree-l3"><a class="reference internal" href="#building-the-sw-application">Building the SW Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="#packaging-the-test">Packaging the Test</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#software-emulation-vck190-only">Software Emulation (VCK190 only)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#troubleshooting">Troubleshooting</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#aie-compilation">AIE Compilation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#aie-simulation">AIE Simulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#hw-testing">HW Testing</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="step_by_step_example.html">Step by Step Example</a></li>
</ul>
<p class="caption"><span class="caption-text">Additional Topics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="trademark.html">Trademark Notice</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">AIE Test Harness</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Using the Test Harness</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="toctree-wrapper compound">
</div>
<div class="section" id="using-the-test-harness">
<h1>Using the Test Harness<a class="headerlink" href="#using-the-test-harness" title="Permalink to this headline">¶</a></h1>
<div class="section" id="environment-setup">
<h2>Environment Setup<a class="headerlink" href="#environment-setup" title="Permalink to this headline">¶</a></h2>
<p>Before building the design with the AIE test harness, you need to source the <code class="docutils literal notranslate"><span class="pre">setup.sh</span></code> script included in this repository. You should also ensure that Vitis, XRT, Versal <code class="docutils literal notranslate"><span class="pre">SDKTARGETSYSROOT</span></code>, and <code class="docutils literal notranslate"><span class="pre">LD_LIBRARY_PATH</span></code> are properly set.</p>
<pre class="highlight literal-block">
<span></span><span class="nb">source</span> &lt;path to Versal common image&gt;/environment-setup-cortexa72-cortexa53-xilinx-linux
<span class="nb">source</span> &lt;path to Vitis installation&gt;/settings64.sh
<span class="nb">source</span> &lt;path to XRT installation&gt;/setup.sh

<span class="nb">source</span> &lt;<span class="nb">test</span> harness repo root folder&gt;/setup.sh
<span class="nb">export</span> <span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span>&lt;your gcc installation&gt;/lib64:<span class="nv">$LD_LIBRARY_PATH</span>
</pre>
</div>
<div class="section" id="instrumenting-the-ai-engine-graph">
<h2>Instrumenting the AI Engine Graph<a class="headerlink" href="#instrumenting-the-ai-engine-graph" title="Permalink to this headline">¶</a></h2>
<p>The following modifications are required to connect the user AIE graph to the test harness:</p>
<div class="section" id="test-harness-header-file">
<h3>Test Harness Header File<a class="headerlink" href="#test-harness-header-file" title="Permalink to this headline">¶</a></h3>
<p>The test harness graph header must be included in the AIE graph sources:</p>
<pre class="highlight literal-block">
<span></span><span class="cp">#include</span> <span class="cpf">&quot;test_harness_graph.hpp&quot;</span>
</pre>
</div>
<div class="section" id="mapping-plios">
<h3>Mapping PLIOs<a class="headerlink" href="#mapping-plios" title="Permalink to this headline">¶</a></h3>
<p>The names and width of the available PLIOs are predefined in the test harness. The original AIE graph must be mapped to these predefined PLIOs to make sure the PL data mover can be correctly connected to the user AIE graph.</p>
<p>The user AIE graph must be modified to ensure that all PLIOs are 128 bits wide and use the PLIOs predefined in the test harness.</p>
<p>The predefined PLIO names are listed in <a class="reference external" href="https://github.com/Xilinx/AI-Engine-Test-Harness/tree/main/include/test_harness_port_name.hpp">include/test_harness_port_name.hpp</a>. The <code class="docutils literal notranslate"><span class="pre">test_harness::in_names</span></code> is the list of PLIO names which can be used to send data to AI Engine and <code class="docutils literal notranslate"><span class="pre">test_harness::out_names</span></code> is the list of PLIO names that can be used to receive data from AI Engine. These are the <strong>ONLY</strong> valid PLIOs to be built with the test harness.</p>
<p><strong>Example</strong></p>
<pre class="highlight literal-block">
<span></span><span class="n">pl_in0</span> <span class="o">=</span> <span class="n">input_plio</span><span class="o">::</span><span class="n">create</span><span class="p">(</span><span class="s">&quot;PLIO_01_TO_AIE&quot;</span>   <span class="p">,</span> <span class="n">adf</span><span class="o">::</span><span class="n">plio_128_bits</span><span class="p">,</span> <span class="s">&quot;DataIn0.txt&quot;</span><span class="p">);</span>
<span class="n">pl_in1</span> <span class="o">=</span> <span class="n">input_plio</span><span class="o">::</span><span class="n">create</span><span class="p">(</span><span class="s">&quot;PLIO_02_TO_AIE&quot;</span>   <span class="p">,</span> <span class="n">adf</span><span class="o">::</span><span class="n">plio_128_bits</span><span class="p">,</span> <span class="s">&quot;DataIn1.txt&quot;</span><span class="p">);</span>
<span class="n">pl_out</span> <span class="o">=</span> <span class="n">output_plio</span><span class="o">::</span><span class="n">create</span><span class="p">(</span><span class="s">&quot;PLIO_01_FROM_AIE&quot;</span><span class="p">,</span> <span class="n">adf</span><span class="o">::</span><span class="n">plio_128_bits</span><span class="p">,</span> <span class="s">&quot;DataOut0.txt&quot;</span><span class="p">);</span>
</pre>
</div>
<div class="section" id="occupying-unused-plios">
<h3>Occupying unused PLIOs<a class="headerlink" href="#occupying-unused-plios" title="Permalink to this headline">¶</a></h3>
<p>All the PLIO ports defined in the test harness must be connected. In case the AIE graph does not need all the PLIOs defined in the test harness, an instance of the <code class="docutils literal notranslate"><span class="pre">test_harness::occupyUnusedPLIO</span></code> helper class must be added to the <code class="docutils literal notranslate"><span class="pre">graph.cpp</span></code> file. This class will help user to occupy all the PLIOs which are not used by the user AIE graph.</p>
<pre class="highlight literal-block">
<span></span><span class="k">template</span> <span class="o">&lt;</span><span class="kt">int</span> <span class="n">used_in_plio</span><span class="p">,</span> <span class="kt">int</span> <span class="n">used_out_plio</span><span class="p">,</span> <span class="kt">int</span> <span class="n">max_num_plio</span><span class="o">&gt;</span>
<span class="k">class</span> <span class="n">occupyUnusedPLIO</span><span class="p">;</span>

<span class="k">template</span> <span class="o">&lt;</span><span class="kt">int</span> <span class="n">used_in_plio</span><span class="p">,</span> <span class="kt">int</span> <span class="n">used_out_plio</span><span class="p">,</span> <span class="kt">int</span> <span class="n">max_num_plio</span><span class="o">&gt;</span>
<span class="n">occupyUnusedPLIO</span><span class="o">::</span><span class="n">occupyUnusedPLIO</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">used_in_plio_names</span><span class="p">,</span>  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">used_out_plio_names</span><span class="p">);</span>
</pre>
<p><strong>Templates</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">used_in_plio</span></code></dt>
<dd>The number of input PLIOs used in the AIE graph</dd>
<dt><code class="docutils literal notranslate"><span class="pre">used_out_plio</span></code></dt>
<dd>The number of output PLIOs used in the AIE graph</dd>
<dt><code class="docutils literal notranslate"><span class="pre">max_num_plio</span></code></dt>
<dd>Maximum number of PLIOs pre-defined in XSA (36 for VCK190, 16 for VEK280)</dd>
</dl>
<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">used_in_plio_names</span></code></dt>
<dd>Vector of strings containing the names of the input PLIOs used by the AIE graph. The length of the vector must match the value of the <code class="docutils literal notranslate"><span class="pre">used_in_plio</span></code> template argument</dd>
<dt><code class="docutils literal notranslate"><span class="pre">used_out_plio_names</span></code></dt>
<dd>Vector of strings containing the names of the output PLIOs used by the AIE graph. The length of the vector must match the value of the <code class="docutils literal notranslate"><span class="pre">used_out_plio</span></code> template argument</dd>
</dl>
<p><strong>Example</strong></p>
<pre class="highlight literal-block">
<span></span><span class="cp">#include</span> <span class="cpf">&quot;test_harness_graph.hpp&quot;</span><span class="cp"></span>

<span class="k">static</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">cust_in</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;PLIO_01_TO_AIE&quot;</span><span class="p">,</span> <span class="s">&quot;PLIO_02_TO_AIE&quot;</span><span class="p">};</span>
<span class="k">static</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">cust_out</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;PLIO_01_FROM_AIE&quot;</span><span class="p">};</span>
<span class="n">test_harness</span><span class="o">::</span><span class="n">occupyUnusedPLIO</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">36</span><span class="o">&gt;</span> <span class="n">unusedPLIOs</span><span class="p">(</span><span class="n">cust_in</span><span class="p">,</span> <span class="n">cust_out</span><span class="p">);</span>
</pre>
</div>
</div>
<div class="section" id="creating-the-sw-application">
<h2>Creating the SW Application<a class="headerlink" href="#creating-the-sw-application" title="Permalink to this headline">¶</a></h2>
<p>A SW application running on the embedded ARM core (PS) of the Versal is necessary to run the test. This SW application must be developped using the <a class="reference internal" href="sw_apis.html#sw-apis"><span class="std std-ref">test harness software APIs</span></a>.</p>
<p>The application usually ressembles the structure and contents of <code class="docutils literal notranslate"><span class="pre">graph.cpp</span></code> file used in x86sim and AIEsim. The main difference is that a different set of APIs is used to transfer data and interact with the AIE graph.</p>
<p>For additional details, refer to the <a class="reference internal" href="step_by_step_example.html#ps-app"><span class="std std-ref">step by step example</span></a> section in this documentation, or the example provided in this repo, such as <a class="reference external" href="https://github.com/Xilinx/AI-Engine-Test-Harness/tree/main/examples/vck190/adder/ps/host.cpp">examples/vck190/adder/ps/host.cpp</a>.</p>
</div>
<div class="section" id="testing-on-hardware">
<h2>Testing on Hardware<a class="headerlink" href="#testing-on-hardware" title="Permalink to this headline">¶</a></h2>
<p>Once the AIE graph has been modified and the SW application has been created, the test can be built and run on the hardware board.</p>
<p>Building the test application is done in three simple steps:</p>
<ol class="arabic simple">
<li>Building the AIE graph</li>
<li>Building the SW application</li>
<li>Packaging the libadf.a, host_elf and other files to create a bootable SD card image</li>
</ol>
<div class="section" id="building-the-ai-engine-graph">
<h3>Building the AI Engine Graph<a class="headerlink" href="#building-the-ai-engine-graph" title="Permalink to this headline">¶</a></h3>
<p>To build the libadf.a for use with the test harness, it must be compiled using the desired prebuilt XSA as the input platform, with the <code class="docutils literal notranslate"><span class="pre">hw</span></code> target, and setting the <code class="docutils literal notranslate"><span class="pre">--event-trace</span></code> and <code class="docutils literal notranslate"><span class="pre">--event-trace-port</span></code> options as shown below:</p>
<p>The prebuilt XSAs are <code class="docutils literal notranslate"><span class="pre">vck190_test_harness_func.xsa</span></code> for functional testing on VCK190, <code class="docutils literal notranslate"><span class="pre">vck190_test_harness_perf.xsa</span></code> for performance testing on VCK190 and <code class="docutils literal notranslate"><span class="pre">vek280_test_harness.xsa</span></code> for performance testing on VEK280.</p>
<pre class="highlight literal-block">
<span></span>v++ -c --mode aie --platform<span class="o">=</span><span class="si">${</span><span class="nv">TEST_HARNESS_REPO_PATH</span><span class="si">}</span>/bin/&lt;vck190_test_harness_func.xsa/vck190_test_harness_perf.xsa/vek280_test_harness.xsa&gt;
                  --target<span class="o">=</span>hw
                  --aie.event-trace runtime
                  --aie.event-trace-port gmio
                  --I <span class="si">${</span><span class="nv">TEST_HARNESS_REPO_PATH</span><span class="si">}</span>/include/
                  <span class="o">[</span>other user options<span class="o">]</span>
</pre>
</div>
<div class="section" id="building-the-sw-application">
<h3>Building the SW Application<a class="headerlink" href="#building-the-sw-application" title="Permalink to this headline">¶</a></h3>
<p>The SW application must be compiled with the ARM cross-compiler and using the Xilinx Runtime (XRT) libraries.</p>
<pre class="highlight literal-block">
<span></span><span class="nb">source</span> &lt;path to Versal common image&gt;/environment-setup-cortexa72-cortexa53-xilinx-linux

<span class="si">${</span><span class="nv">CXX</span><span class="si">}</span> test.cpp -c -I<span class="si">${</span><span class="nv">XILINX_XRT</span><span class="si">}</span>/include -I<span class="si">${</span><span class="nv">TEST_HARNESS_REPO_PATH</span><span class="si">}</span>/include -o test.o
<span class="si">${</span><span class="nv">CXX</span><span class="si">}</span> test.o -lxrt_coreutil -L<span class="si">${</span><span class="nv">XILINX_XRT</span><span class="si">}</span>/lib -o host_elf
</pre>
</div>
<div class="section" id="packaging-the-test">
<h3>Packaging the Test<a class="headerlink" href="#packaging-the-test" title="Permalink to this headline">¶</a></h3>
<p>The AIE test harness includes utility scripts which can be used to package the test files and generate a bootable SD card image to run the test on the hardware board on either VCK190 or VEK280.</p>
<p><strong>VCK190</strong></p>
<pre class="highlight literal-block">
<span></span>test_harness/package_&lt;vck190/vek280&gt;_hw.sh &lt;output dir&gt;
                                           &lt;func_libadf.a&gt;
                                           &lt;perf_libadf.a&gt;
                                           &lt;host_elf&gt;
                                           &lt;other files needed by the test&gt;
</pre>
<p><strong>VEK280</strong></p>
<pre class="highlight literal-block">
<span></span>test_harness/package_&lt;vck190/vek280&gt;_hw.sh &lt;output dir&gt;
                                           &lt;perf_libadf.a&gt;
                                           &lt;host_elf&gt;
                                           &lt;other files needed by the test&gt;
</pre>
<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">&lt;output</span> <span class="pre">dir&gt;</span></code></dt>
<dd>The folder in which the output of the packaging script and the bootable SD card image should be generated.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">&lt;func_libadf.a&gt;</span></code></dt>
<dd>The libadf.a resulting from compiling the AIE graph with the pre-compiled .xsa for functional testing (vck190_test_harness_func.xsa).</dd>
<dt><code class="docutils literal notranslate"><span class="pre">&lt;perf_libadf.a&gt;</span></code></dt>
<dd>The libadf.a resulting from compiling the AIE graph with the pre-compiled .xsa for performance testing (vck190_test_harness_perf.xsa or vek280_test_harness.xsa).</dd>
<dt><code class="docutils literal notranslate"><span class="pre">&lt;host_elf&gt;</span></code></dt>
<dd>The executable resulting from building the SW application.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">&lt;other</span> <span class="pre">files</span> <span class="pre">needed</span> <span class="pre">by</span> <span class="pre">the</span> <span class="pre">test&gt;</span></code></dt>
<dd>A list of other files needed by the test and to be packaged in the SD card image. This can be for instance input data files required by the test application and the running script for executing the application test.</dd>
</dl>
</div>
</div>
<div class="section" id="software-emulation-vck190-only">
<h2>Software Emulation (VCK190 only)<a class="headerlink" href="#software-emulation-vck190-only" title="Permalink to this headline">¶</a></h2>
<p>The AIE test harness also provides support for packaging and running the test in the software emulation mode for VCK190.</p>
<p>In the software emulation mode, the AIE graph is compiled for x86sim and the SW application is compiled using the native compiler of the host system.</p>
<p>This mode allows testing the SW application and making sure that it works correctly before running the test on hardware.</p>
<p class="rubric">Building the AI Engine Graph</p>
<p>Building the AIE graph for software emulation is similar to building it for HW, except that the <code class="docutils literal notranslate"><span class="pre">x86sim</span></code> target should be used:</p>
<pre class="highlight literal-block">
<span></span>v++ -c --mode aie --platform<span class="o">=</span><span class="si">${</span><span class="nv">TEST_HARNESS_REPO_PATH</span><span class="si">}</span>/bin/&lt;vck190_test_harness_func.xsa/vck190_test_harness_perf.xsa&gt;
                  --target<span class="o">=</span>x86sim
                  --aie.event-trace runtime
                  --aie.event-trace-port gmio
                  --I <span class="si">${</span><span class="nv">TEST_HARNESS_REPO_PATH</span><span class="si">}</span>/include/
                  <span class="o">[</span>other user options<span class="o">]</span>
</pre>
<p class="rubric">Building the SW Application</p>
<p>Building the SW application for software emulation is similar to building it for HW, except that the native g++ compiler should be used:</p>
<pre class="highlight literal-block">
<span></span>g++ test.cpp -c -I<span class="si">${</span><span class="nv">XILINX_XRT</span><span class="si">}</span>/include -I<span class="si">${</span><span class="nv">TEST_HARNESS_REPO_PATH</span><span class="si">}</span>/include -o test.o
g++ test.o -lxrt_coreutil -L<span class="si">${</span><span class="nv">XILINX_XRT</span><span class="si">}</span>/lib -o host_elf
</pre>
<p class="rubric">Packaging the Test</p>
<p>Packaging the test for software emulation is similar to packaging it for HW, except that the package_sw_emu.sh script should be used:</p>
<pre class="highlight literal-block">
<span></span>test_harness/package_sw_emu.sh &lt;output dir&gt;
                               &lt;func_libadf.a&gt;
                               &lt;perf_libadf.a&gt;
                               &lt;host_elf&gt;
                               &lt;other files needed by the test&gt;
</pre>
<p class="rubric">Running SW emulation</p>
<p>To run the test in software emulation mode, first set the <code class="docutils literal notranslate"><span class="pre">XCL_EMULATION_MODE</span></code> variable to <code class="docutils literal notranslate"><span class="pre">sw_emu</span></code> before running the natively compiled test application:</p>
<pre class="highlight literal-block">
<span></span><span class="nb">cd</span> &lt;sw emu output dir&gt;
<span class="nb">export</span> <span class="nv">XCL_EMULATION_MODE</span><span class="o">=</span>sw_emu
./host_elf &lt;optional args&gt;
</pre>
</div>
<div class="section" id="troubleshooting">
<h2>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this headline">¶</a></h2>
<div class="section" id="aie-compilation">
<h3>AIE Compilation<a class="headerlink" href="#aie-compilation" title="Permalink to this headline">¶</a></h3>
<p><strong>Issue:</strong> The following error message is seen when compiling the AIE graph with the test harness XSA: <code class="docutils literal notranslate"><span class="pre">ERROR:</span> <span class="pre">[aiecompiler</span> <span class="pre">77-4252]</span> <span class="pre">For</span> <span class="pre">application</span> <span class="pre">port</span> <span class="pre">with</span> <span class="pre">annotation</span> <span class="pre">'PLIO_01_TO_AIE'</span> <span class="pre">the</span> <span class="pre">buswidth</span> <span class="pre">is</span> <span class="pre">32-bits,</span> <span class="pre">which</span> <span class="pre">is</span> <span class="pre">different</span> <span class="pre">than</span> <span class="pre">the</span> <span class="pre">buswidth</span> <span class="pre">of</span> <span class="pre">128-bits</span> <span class="pre">as</span> <span class="pre">specified</span> <span class="pre">in</span> <span class="pre">incoming</span> <span class="pre">logical</span> <span class="pre">architecture</span></code></p>
<ul class="simple">
<li>The width of the PLIOs in the prebuilt XSA is set to 128 bits. The PLIO widths in the AIE graph must match with the XSA. Set all PLIO width in the graph to <code class="docutils literal notranslate"><span class="pre">adf::plio_128_bits</span></code>.</li>
</ul>
<p><strong>Issue:</strong> The following error message is seen when compiling the AIE graph with the test harness XSA: <code class="docutils literal notranslate"><span class="pre">ERROR:</span> <span class="pre">[aiecompiler</span> <span class="pre">77-295]</span> <span class="pre">Cannot</span> <span class="pre">find</span> <span class="pre">port</span> <span class="pre">instance</span> <span class="pre">tf0_pi0</span> <span class="pre">corresponding</span> <span class="pre">to</span> <span class="pre">Logical</span> <span class="pre">Arch</span> <span class="pre">Port</span> <span class="pre">M00_AXI</span></code></p>
<ul class="simple">
<li>The <code class="docutils literal notranslate"><span class="pre">--aie.event-trace</span> <span class="pre">runtime</span> <span class="pre">--aie.event-trace-port</span> <span class="pre">gmio</span></code> options are missing for the <code class="docutils literal notranslate"><span class="pre">v++</span> <span class="pre">-c</span> <span class="pre">--mode</span> <span class="pre">aie</span></code> command</li>
</ul>
</div>
<div class="section" id="aie-simulation">
<h3>AIE Simulation<a class="headerlink" href="#aie-simulation" title="Permalink to this headline">¶</a></h3>
<p><strong>Issue:</strong> The following error message is seen when running x86sim or AIEsim after modifying the graph to work with the test harness: <code class="docutils literal notranslate"><span class="pre">Error:</span> <span class="pre">Could</span> <span class="pre">not</span> <span class="pre">open</span> <span class="pre">input</span> <span class="pre">file</span> <span class="pre">:</span> <span class="pre">./data/dummy.txt</span></code></p>
<ul class="simple">
<li>The unused PLIOs are expecting an input data file called <code class="docutils literal notranslate"><span class="pre">./data/dummy.txt</span></code>. Create an empty file with this name and in this folder, then rerun x86sim or AIEsim.</li>
</ul>
</div>
<div class="section" id="hw-testing">
<h3>HW Testing<a class="headerlink" href="#hw-testing" title="Permalink to this headline">¶</a></h3>
<p><strong>Issue:</strong> When running on HW, the performance numbers reported by the test harness vary a lot from run to run.</p>
<ul class="simple">
<li>Making sure to start the AIE graph before starting the PL DMA engine. The performance counters start at the same time as the PL DMA engine starts. If the graph is not already started and ready to transfer data, the performance counters will be incremented by an arbitrary number of cycles before the application actually starts.</li>
</ul>
</div>
</div>
</div>


           </div>
          </div>
          
				  
				  <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="sw_apis.html" class="btn btn-neutral float-left" title="Software APIs" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="step_by_step_example.html" class="btn btn-neutral float-right" title="Step by Step Example" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Advanced Micro Devices, Inc.
      <span class="lastupdated">Last updated on October 23, 2023.
      </span></p>
  </div>



										<div class="aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid sub-footer">

													                    <div class="row">
                        <div class="col-xs-24">
                          <p><a target="_blank" href="https://www.amd.com/en/corporate/copyright">Terms and Conditions</a> | <a target="_blank" href="https://www.amd.com/en/corporate/privacy">Privacy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/cookies">Cookie Policy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/trademarks">Trademarks</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/statement-human-trafficking-forced-labor.pdf">Statement on Forced Labor</a> | <a target="_blank" href="https://www.amd.com/en/corporate/competition">Fair and Open Competition</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/amd-uk-tax-strategy.pdf">UK Tax Strategy</a> | <a target="_blank" href="https://docs.xilinx.com/v/u/9x6YvZKuWyhJId7y7RQQKA">Inclusive Terminology</a> | <a href="#cookiessettings" class="ot-sdk-show-settings">Cookies Settings</a></p>
                        </div>
                    </div>
												</div>
											</div>
										</div>
										
</br>


  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>