<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
<!-- OneTrust Cookies Consent Notice start for xilinx.github.io -->

<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="03af8d57-0a04-47a6-8f10-322fa00d8fc7" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice end for xilinx.github.io -->
<!-- Google Tag Manager -->
<script type="text/plain" class="optanon-category-C0002">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5RHQV7');</script>
<!-- End Google Tag Manager -->
  <title>Step by Step Example &mdash; AIE Test Harness v2023.1 documentation</title><link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Limitations" href="limitations.html" />
    <link rel="prev" title="Using the Test Harness" href="build_with_harness.html" /> 
</head>

<body class="wy-body-for-nav">

<!-- Google Tag Manager -->
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5RHQV7" height="0" width="0" style="display:none;visibility:hidden" class="optanon-category-C0002"></iframe></noscript>
<!-- End Google Tag Manager --> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
            <a href="index.html" class="icon icon-home"> AIE Test Harness
          </a>
              <div class="version">
                2023.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
</ul>
<p class="caption"><span class="caption-text">User Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="hw_feature.html">Hardware Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="sw_api.html">Software APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="build_with_harness.html">Using the Test Harness</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Step by Step Example</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#adopt-correct-plio">1. Adopt correct PLIO</a></li>
<li class="toctree-l2"><a class="reference internal" href="#occupy-unused-plio">2. Occupy unused PLIO</a></li>
<li class="toctree-l2"><a class="reference internal" href="#create-ps-application">3. Create PS application</a></li>
<li class="toctree-l2"><a class="reference internal" href="#run-software-emulation">4. Run software emulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#package-sd-card-image">5. Package SD card image</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="limitations.html">Limitations</a></li>
</ul>
<p class="caption"><span class="caption-text">Additional Topics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="trademark.html">Trademark Notice</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">AIE Test Harness</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Step by Step Example</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="toctree-wrapper compound" id="step-by-step">
</div>
<div class="section" id="step-by-step-example">
<h1>Step by Step Example<a class="headerlink" href="#step-by-step-example" title="Permalink to this headline">¶</a></h1>
<p>We provide 4 cases from Vitis-Tutorials to demonstrate how to use test harness to with AI Engine. We will take <code class="docutils literal notranslate"><span class="pre">examples/super-sampling-rate-fir/SingleKernel</span></code> as an example.</p>
<div class="section" id="adopt-correct-plio">
<h2>1. Adopt correct PLIO<a class="headerlink" href="#adopt-correct-plio" title="Permalink to this headline">¶</a></h2>
<p>This case uses 1x input_plio and 1x output_plio. We pick “Column_12_TO_AIE” to send data to AI Engine and “Column_28_FROM_AIE” to receive data from AI Engine. “Column_XX” in PLIO names is the shim tile coordinate we used for certain PLIO. In case your design failed during mapping, please try other PLIO ports. All valid PLIO names can be found from <code class="docutils literal notranslate"><span class="pre">include/vck190_test_harness_port_name.hpp</span></code>.</p>
<pre class="highlight literal-block">
<span></span><span class="n">TopGraph</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">input_plio</span> <span class="n">plin</span> <span class="o">=</span> <span class="n">input_plio</span><span class="o">::</span><span class="n">create</span><span class="p">(</span><span class="s">&quot;Column_12_TO_AIE&quot;</span><span class="p">,</span> <span class="n">plio_128_bits</span><span class="p">,</span> <span class="s">&quot;data/PhaseIn_0.txt&quot;</span><span class="p">,</span> <span class="mi">250</span><span class="p">);</span>
    <span class="n">output_plio</span> <span class="n">plout</span> <span class="o">=</span> <span class="n">output_plio</span><span class="o">::</span><span class="n">create</span><span class="p">(</span><span class="s">&quot;Column_28_FROM_AIE&quot;</span><span class="p">,</span> <span class="n">plio_128_bits</span><span class="p">,</span> <span class="s">&quot;data/Output_0.txt&quot;</span><span class="p">,</span> <span class="mi">250</span><span class="p">);</span>
    <span class="n">connect</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="n">plin</span><span class="p">.</span><span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">G1</span><span class="p">.</span><span class="n">in</span><span class="p">);</span>
    <span class="n">connect</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="n">G1</span><span class="p">.</span><span class="n">out</span><span class="p">,</span> <span class="n">plout</span><span class="p">.</span><span class="n">in</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
<span class="p">}</span>
</pre>
</div>
<div class="section" id="occupy-unused-plio">
<h2>2. Occupy unused PLIO<a class="headerlink" href="#occupy-unused-plio" title="Permalink to this headline">¶</a></h2>
<p>Because this case does not used all PLIOs, we need to put a dummy graph to occupy all unused PLIOs.
<code class="docutils literal notranslate"><span class="pre">occupyUnusedPLIO</span></code> is a template design. We need to provide number of used input_plio and output_plio, and names of used input_plio and output_plio.</p>
<pre class="highlight literal-block">
<span></span><span class="k">static</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">cust_in</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;Column_12_TO_AIE&quot;</span><span class="p">};</span>
<span class="k">static</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">cust_out</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;Column_28_FROM_AIE&quot;</span><span class="p">};</span>
<span class="n">TopGraph</span> <span class="n">G</span><span class="p">;</span>
<span class="n">vck190_test_harness</span><span class="o">::</span><span class="n">occupyUnusedPLIO</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="o">&gt;</span> <span class="n">dummyGraph</span><span class="p">(</span><span class="n">cust_in</span><span class="p">,</span> <span class="n">cust_out</span><span class="p">);</span>
</pre>
</div>
<div class="section" id="create-ps-application">
<h2>3. Create PS application<a class="headerlink" href="#create-ps-application" title="Permalink to this headline">¶</a></h2>
<p>To drive test harness and AI Engine application from PS side, we need to instantiate one instance of <code class="docutils literal notranslate"><span class="pre">vck190_test_harness::test_harness_mgr</span></code>.
We want to load <code class="docutils literal notranslate"><span class="pre">in_sz</span></code> bytes of data to channel <code class="docutils literal notranslate"><span class="pre">Column_12_TO_AIE</span></code> and receive <code class="docutils literal notranslate"><span class="pre">out_sz</span></code> bytes of data from channel <code class="docutils literal notranslate"><span class="pre">Column_28_FROM_AIE</span></code>.
We know that each iteration of graph “G” can consume <code class="docutils literal notranslate"><span class="pre">in_sz</span></code> bytes of data and generate <code class="docutils literal notranslate"><span class="pre">out_sz</span></code> bytes of data.
To support multiple runs of graph “G”, we set the repetition count of <code class="docutils literal notranslate"><span class="pre">test_harness_arg</span></code> to 4, same as total iteration of graph run.
In order to measure total latency of each channel, we strongly recommend to call <code class="docutils literal notranslate"><span class="pre">runAIEGraph</span></code> before <code class="docutils literal notranslate"><span class="pre">runTestHarness</span></code>.</p>
<pre class="highlight literal-block">
<span></span><span class="n">test_harness_mgr</span> <span class="nf">mgr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">{</span><span class="s">&quot;G&quot;</span><span class="p">});</span>
<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">test_harness_args</span><span class="o">&gt;</span> <span class="n">args</span><span class="p">;</span>
<span class="n">args</span><span class="p">.</span><span class="n">push_back</span><span class="p">({</span><span class="n">channel_index</span><span class="p">(</span><span class="n">Column_12_TO_AIE</span><span class="p">),</span> <span class="n">in_sz</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">in_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]});</span>
<span class="n">args</span><span class="p">.</span><span class="n">push_back</span><span class="p">({</span><span class="n">channel_index</span><span class="p">(</span><span class="n">Column_28_FROM_AIE</span><span class="p">),</span> <span class="n">out_sz</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">out_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]});</span>
<span class="n">mgr</span><span class="p">.</span><span class="n">runAIEGraph</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
<span class="n">mgr</span><span class="p">.</span><span class="n">runTestHarness</span><span class="p">(</span><span class="n">args</span><span class="p">);</span>
<span class="n">mgr</span><span class="p">.</span><span class="n">waitForRes</span><span class="p">(</span><span class="mi">10000</span><span class="p">);</span>
</pre>
</div>
<div class="section" id="run-software-emulation">
<h2>4. Run software emulation<a class="headerlink" href="#run-software-emulation" title="Permalink to this headline">¶</a></h2>
<p>After we got libadf.a (x86sim targeted) and PS executable, we can run software emulation for quick verification.</p>
<pre class="highlight literal-block">
<span></span><span class="si">${</span><span class="nv">TEST_HARNESS_REPO_PATH</span><span class="si">}</span>/test_harness/package_sw_emu.sh <span class="si">${</span><span class="nv">PKG_DIR</span><span class="si">}</span> <span class="si">${</span><span class="nv">AIE_EXE</span><span class="si">}</span> <span class="si">${</span><span class="nv">HOST_EXE</span><span class="si">}</span>
<span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="k">$(</span>LIBRARY_PATH<span class="k">)</span>:<span class="nv">$$</span>LD_LIBRARY_PATH <span class="nv">XCL_EMULATION_MODE</span><span class="o">=</span>sw_emu <span class="k">$(</span>PKG_DIR<span class="k">)</span>/host_elf <span class="k">$(</span>PKG_DIR<span class="k">)</span>/vck190_test_harness.xclbin
</pre>
</div>
<div class="section" id="package-sd-card-image">
<h2>5. Package SD card image<a class="headerlink" href="#package-sd-card-image" title="Permalink to this headline">¶</a></h2>
<p>After we got libadf.a (hw targeted), PS executable and vck190_test_harness.xsa, we can package SD card image for on-board running.</p>
<pre class="highlight literal-block">
<span></span><span class="si">${</span><span class="nv">TEST_HARNESS_REPO_PATH</span><span class="si">}</span>/test_harness/package_hw.sh <span class="si">${</span><span class="nv">PKG_DIR</span><span class="si">}</span> <span class="si">${</span><span class="nv">AIE_EXE</span><span class="si">}</span> <span class="si">${</span><span class="nv">HOST_EXE</span><span class="si">}</span>
</pre>
</div>
</div>


           </div>
          </div>
          
                  <style>
                        .footer {
                        position: fixed;
                        left: 0;
                        bottom: 0;
                        width: 100%;
                        }
                  </style>
				  
				  <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="build_with_harness.html" class="btn btn-neutral float-left" title="Using the Test Harness" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="limitations.html" class="btn btn-neutral float-right" title="Limitations" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Advanced Micro Devices, Inc.
      <span class="lastupdated">Last updated on April 13, 2023.
      </span></p>
  </div>



										<div class="aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid sub-footer">

													                    <div class="row">
                        <div class="col-xs-24">
                          <p><a target="_blank" href="https://www.amd.com/en/corporate/copyright">Terms and Conditions</a> | <a target="_blank" href="https://www.amd.com/en/corporate/privacy">Privacy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/cookies">Cookie Policy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/trademarks">Trademarks</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/statement-human-trafficking-forced-labor.pdf">Statement on Forced Labor</a> | <a target="_blank" href="https://www.amd.com/en/corporate/competition">Fair and Open Competition</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/amd-uk-tax-strategy.pdf">UK Tax Strategy</a> | <a target="_blank" href="https://docs.xilinx.com/v/u/9x6YvZKuWyhJId7y7RQQKA">Inclusive Terminology</a> | <a href="#cookiessettings" class="ot-sdk-show-settings">Cookies Settings</a></p>
                        </div>
                    </div>
												</div>
											</div>
										</div>
										
</br>


  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>